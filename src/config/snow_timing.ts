
// 用户在 PS 中测量时的基准宽度
// 经校准：28000 时前1分钟良好，但210秒时累积快约3秒，调整为 28500
export const PS_MEASURE_WIDTH = 28500;

// SVG 文件的原始 viewBox 宽度 (从 snow_visual.svg 的 viewBox="0 0 113374 2267" 提取)
export const SVG_VIEWBOX_WIDTH = 113374;

// 兼容旧名称
export const REFERENCE_WIDTH = PS_MEASURE_WIDTH;
export const SVG_ORIGINAL_WIDTH = SVG_VIEWBOX_WIDTH;

/**
 * 原始时间-坐标映射数据
 * 格式: HH:MM:SS:CC,PixelX
 * 请在此处粘贴您的数据
 */
export const RAW_TIMING_DATA = `
00:00:00:00,130
00:00:03:00,649
00:00:06:00,1130
00:00:09:00,1643
00:00:12:00,1951
00:00:15:00,2205
00:00:18:00,2458
00:00:21:00,2732
00:00:24:00,3048
00:00:27:00,3366
00:00:30:00,3682
00:00:33:00,4000
00:00:36:00,4322
00:00:39:00,4646
00:00:42:00,4964
00:00:45:00,5283
00:00:48:00,5634
00:00:51:00,5938
00:00:54:00,6240
00:00:57:00,6560
00:01:00:00,6880
00:01:03:00,7198
00:01:06:00,7670
00:01:09:00,8152
00:01:12:00,8630
00:01:15:00,9110
00:01:18:00,9498
00:01:21:00,9768
00:01:24:00,10040
00:01:27:00,10334
00:01:30:00,10794
00:01:33:00,11274
00:01:36:00,11756
00:01:39:00,12294
00:01:42:00,12680
00:01:45:00,12998
00:01:48:00,13316
00:01:51:00,13718
00:01:54:00,14388
00:01:57:00,15026
00:02:00:00,15660
00:02:03:00,16220
00:02:06:00,16854
00:02:09:00,17490
00:02:12:00,18126
00:02:15:00,18662
00:02:18:00,19208
00:02:21:00,19682
00:02:24:00,19976
00:02:27:00,20456
00:02:30:00,20936
00:02:33:00,21415
00:02:36:00,21800
00:02:39:00,22075
00:02:42:00,22346
00:02:45:00,22640
00:02:48:00,23100
00:02:51:00,23682
00:02:54:00,24060
00:02:57:00,24600
00:03:00:00,24986
00:03:03:00,25304
00:03:06:00,25620
00:03:09:00,26060
00:03:12:00,26310
00:03:15:00,26586
00:03:18:00,26838
00:03:21:00,26974
00:03:24:00,27108
00:03:27:00,27588
00:03:30:00,28070
00:03:33:00,28306
00:03:40:00,28306
`;

export interface TimingPoint {
  time: number; // 秒数
  x: number;    // 像素坐标
}

/**
 * 将 HH:MM:SS:CC 格式解析为秒数 (float)
 * CC 是厘秒 (1/100 秒)
 */
function timeToSeconds(timeStr: string): number {
  const [hh, mm, ss, cc] = timeStr.split(':').map(Number);
  return hh * 3600 + mm * 60 + ss + cc / 100;
}

/**
 * 解析原始字符串数据并按时间排序
 */
export function parseTimingData(raw: string): TimingPoint[] {
  return raw
    .trim()
    .split('\n')
    .filter(line => line.trim() !== '')
    .map(line => {
      const [timeStr, xStr] = line.split(',');
      return {
        time: timeToSeconds(timeStr.trim()),
        x: parseFloat(xStr.trim())
      };
    })
    .sort((a, b) => a.time - b.time);
}
